@page "/Sections"
@model A.C.E.S.Pages.Sections.SectionsModel
@{
    ViewData["Title"] = "Sections";
}

<section id="top-bar">
    <div>
        <input id="filter-section-name" type="text" placeholder="Search Section" onkeyup="LoadList()" />
        <select id="filter-section-status" onchange="LoadList()">
            <option>Active</option>
            <option>Archived</option>
        </select>
    </div>
    <div>
        <a class="button" onclick="$('#add-course').animate({ width: 'toggle' });">+ Add Section</a>
    </div>
</section>
<section id="course-list">
</section>
<aside id="add-course" class="pop-up">
    <h2>Add Section</h2>
    <form action="/Sections/Add">
        <div><label for="name">Name:</label></div>
        <div><input id="name" name="name" type="text" /></div>
        <div><label>Term</label></div>
        <div>
            <select>
                <option>Spring</option>
                <option>Summer</option>
                <option>Fall</option>
            </select>
            <select>
                <option>Full</option>
                <option>1<sup>st</sup> Block</option>
                <option>2<sup>nd</sup> Block</option>
            </select>
            <select>
                @for (int i = 0; i < 3; i++) {
                    <option>@(DateTime.Now.Year + i)</option>
                }
            </select>
        </div>
        <p>
            <input type="submit" value="Add" />
            <input type="button" value="Cancel" onclick="$('#add-course').animate({ width: 'toggle' });" />
        </p>
    </form>
</aside>
<aside id="add-student" class="pop-up"></aside>
<script>
    sections = JSON.parse('@Json.Serialize(Model.Sections)');

    function LoadList() {
        var count = 0;

        var name = document.getElementById('filter-section-name').value;
        var status = document.getElementById('filter-section-status').value;

        var elem = document.getElementById('course-list');
        elem.innerHTML = "";

        for (var section of sections) {
            if (section.archived && status == "Active") continue;
            if (!section.archived && status == "Archived") continue;
            if (!section.name.toLowerCase().includes(name.toLowerCase())) continue;

            count++;

            var accordion = document.createElement('div');
            accordion.classList.add('accordion');
            accordion.innerHTML += `<div class="accordion-header"><a href="/Sections/${section.id}">${section.name}</a></div>`;

            var content = document.createElement('div');
            content.classList.add('accordion-content');

            var table = document.createElement('table');
            var colgroup = document.createElement('colgroup');
            colgroup.innerHTML += '<col style="width:30%;" />';
            colgroup.innerHTML += '<col style="width:40%;" />';
            colgroup.innerHTML += '<col style="width:30%;" />';
            table.appendChild(colgroup);

            var tbody = document.createElement('tbody');
            tbody.id = "student-list";
            for (var student of section.students) {
                if (student.archived) continue;

                var tr = document.createElement("tr");
                tr.innerHTML += '<td><a href="/Students/' + student.id + '">' + student.name + '</a></td>';
                tr.innerHTML += '<td>' + student.email + '</td>';
                switch (student.standing) {
                    case 0:
                        tr.innerHTML += '<td><i class="green-text fas fa-star"></i><i class="green-text fas fa-star"></i><i class="green-text fas fa-star"></i> Good</td>';
                        break;
                    case 1:
                        tr.innerHTML += '<td><i class="orange-text fas fa-star"></i><i class="orange-text fas fa-star"></i><i class="far fa-star"></i> Moderate</td>';
                        break;
                    case 2:
                        tr.innerHTML += '<td><i class="red-text fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i> Bad</td>';
                        break;
                    default:
                        tr.innerHTML += '<td><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i> N/A</td>';
                        break;
                }
                tbody.appendChild(tr);
            }
            //tbody.innerHTML += `<tr><td colspan="3"><a onclick="ToggleManageStudents('${section.id}');">Add Student</a></td></tr>`;

            table.appendChild(tbody);
            content.appendChild(table);

            accordion.appendChild(content);
            elem.appendChild(accordion);
        }
        if (count == 0) {
            elem.innerHTML = '<div>There are no semesters</div>';
        }
        $(".accordion-header").click(function () {
            $(this).next().slideToggle();
            $(this).toggleClass('expanded');
        });
        //$('.accordion-content').hide();
    }

    function ToggleAddCourse() {
        if ($('#add-student').is(':visible')) $('#add-student').animate({ width: 'toggle' });
        $('#add-course').animate({ width: 'toggle' });
    }

    function ToggleManageStudents(id) {
        if ($('#add-course').is(':visible')) $('#add-course').animate({ width: 'toggle' });
        $('#add-student').animate({ width: 'toggle' });
        if ($('#add-student').is(':visible')) LoadStudentList(id);
    }

    function LoadStudentList(id) {
        var elem = document.getElementById("add-student");
        var section = null;
        for(var s of sections) {
            if (s.id == id) section = s;
        }
        if (section == null) return;

        elem.innerHTML = `<h2>Students in ${section.name}</h2>`;
    }

    LoadList();
</script>